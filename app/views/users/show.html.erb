<section class="dashboard-main">
  <h1> <%= facade.user.first_name %>'s Dashboard </h1>

  <%= button_to 'Log Out', logout_path, method: 'delete', class: "btn btn-primary mb1 bg-teal" %>
  <% if facade.user.github_token.nil? %>
    <%= button_to 'Connect to Github', '/auth/github', class: "btn btn-primary mb1 bg-teal" %>
  <% end %>
  <h3>Account Details</h3>
  <ul>
    <li> <%= facade.user.first_name  %> <%= facade.user.last_name %> </li>
    <li> <%= facade.user.email%> </li>
  </ul>





  <section>
    <h1>Bookmarked Segments</h1>
    <% current_user.videos.order(tutorial_id: :asc).order(position: :asc).each do |video| %>
      <h3><%= video.tutorial.title %> - <%= video.title %></h3>
    <% end %>
  </section>





  <% if facade.user.github_token %>
    <section>
      <h1>Github</h1>
      <h3>Repositories</h3>
        <% facade.repositories.each do |repo| %>
        <ul>
          <li class='repository'><%= link_to repo.name, repo.url %></li>
        </ul>
        <% end %>
    </section>

    <section>
      <h3>Followers</h3>
      <% facade.followers.each do |follower| %>
      <ul>
        <li class='follower'><%= link_to follower.handle, follower.url %></li>
        <% if follower.follower_has_account?(facade.user) %>
        <%= button_to 'Add as Friend', friends_path, method: :post, class: "btn btn-primary mb1 bg-teal", params: {github_id: follower.github_id} %>
        <% end %>
      </ul>
      <% end %>
    </section>

    <section>
      <h3>Following</h3>
      <% facade.following.each do |following| %>
      <ul>
        <li class='follower'><%= link_to following.handle, following.url %></li>
        <% if following.follower_has_account?(facade.user) %>
        <%= button_to 'Add as Friend', friends_path, method: :post, class: "btn btn-primary mb1 bg-teal", params: {github_id: following.github_id} %>
        <% end %>
      </ul>
      <% end %>
    </section>

    <section>
      <h3>Friends</h3>
      <% facade.user.friends.each do |friend| %>
      <ul>
        <%x = User.find_by(github_id: friend.github_id)%>
        <li><%= x.first_name + ' ' + x.last_name %></li>
      <% end %>
      </ul>
    </section>
  <% end %>

</section>
